"use strict";!function(angular){angular.module("app",[]).directive("chocoboRangePicker",["$filter",function($filter){return String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Date.prototype.reverseFormat=function(tDate,locale){if("pt-BR"===locale||"en-GB"===locale){var formatDate=tDate.split("/");return new Date(formatDate[2],formatDate[1]-1,formatDate[0])}if("de-DE"===locale){var parts=tDate.match(/(\d+)/g);return new Date(parts[2],parts[1]-1,parts[0])}return new Date(tDate)},{require:"ngModel",restrict:"AE",scope:{locale:"@",options:"="},link:function(scope,elem,attrs,ngModel){function getNextSaturday(){var now=new Date;return now.setDate(now.getDate()+(6+(7-now.getDay()))%7),now.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()}function getDaySaturday(now){return now.setDate(now.getDate()+(7+(7-now.getDay()))%7),now.toLocaleDateString(attrs.locale,optionsDay)}function findFirstCalendarNext(element,index,array){if(array.length===index+1){var dt=new Date(dateInitial);dt.setDate(getLastDayOfMonth(dt)),setNextDaysOfNextMonth(element,dt,!0)}}function findFirstCalendarLast(element,index,array){var FIRST_WEEK=0;if(index===FIRST_WEEK){var td=new Date(dateInitial);setLastDaysOfLastMonth(element,td,!0)}}function findSecondCalendarLast(element,index,array){var FIRST_WEEK=0;if(index===FIRST_WEEK){var td=new Date(dateFinal);setLastDaysOfLastMonth(element,td)}}function findSecondCalendarNext(element,index,array){if(array.length===index+1){var dt=new Date(scope.endDate);dt.setDate(getLastDayOfMonth(dt)),setNextDaysOfNextMonth(element,dt)}}function getLastDayOfWeek(day){var now=new Date;return now.setDate(now.getDate()+(day+(7-now.getDay()))%7),now.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()}function getNextWeekLastDay(now){var dt=new Date(now);return dt.setDate(dt.getDate()+(13-dt.getDay())%7),dt}function setNextDaysOfNextMonth(element,dt,isInital){var nextSadurday=getNextWeekLastDay(dt),lastDay=dt;for(lastDay.setHours(0,0,0,0),nextSadurday.setHours(0,0,0,0),lastDay.setDate(lastDay.getDate()+1);lastDay<=nextSadurday;){var tempDate=lastDay;isInital?element[new Date(tempDate).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()]={date:new Date(lastDay),"class":"next-month",select:compareDate(tempDate)?"hover-range-normal":"",isReadyOnly:lastDay>scope.endDate}:element[new Date(tempDate).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()]={date:new Date(lastDay),"class":"next-month",select:compareDate(tempDate)?"hover-range-normal":"",isReadyOnly:!1},lastDay.setDate(lastDay.getDate()+1)}}function setLastDaysOfLastMonth(element,dt,isInital){if(dt.setDate(1),getLastDayOfWeek(7)!=dt.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()){var lastSunday=getLastSunday(dt),lastDayOfMonth=new Date(lastSunday.getUTCFullYear(),lastSunday.getUTCMonth()+1,0);for(lastSunday.setHours(0,0,0,0),lastDayOfMonth.setHours(0,0,0,0);lastSunday<=lastDayOfMonth;){var tempDate=lastSunday;isInital?element[new Date(tempDate).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()]={date:new Date(lastSunday),"class":"prev-month",select:compareDate(tempDate)?"hover-range-normal":"",isReadyOnly:!1}:element[new Date(tempDate).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()]={date:new Date(lastSunday),"class":"prev-month",select:compareDate(tempDate)?"hover-range-normal":"",isReadyOnly:lastSunday<scope.startDate},lastSunday.setDate(lastSunday.getDate()+1)}}}function getWeekDays(tDate){var dt=new Date(tDate);dt=new Date(dt.getFullYear(),dt.getMonth(),getDaySaturday(dt));for(var weekList=[],tDay=parseInt(getDaySaturday(dt)),index=0;index<7;index++){var day=tDay+index,dtTemp=new Date(dt.getFullYear(),dt.getMonth(),day);weekList.push(dtTemp.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter())}return weekList}function getLastDayOfMonth(tDate){var dt=new Date(tDate.getUTCFullYear(),tDate.getUTCMonth()+1,0);return dt.toLocaleDateString(attrs.locale,optionsDay)}function setRangeDate(){var currentDate=scope.startDate.reverseFormat(scope.startDate.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale);between=getRangeDate(currentDate,new Date(scope.endDate)).splice(0),changeDate(scope.startDate,!0),changeDate(scope.endDate,!1),ngModel.$setViewValue(between),ngModel.$render()}function compareDate(tDate){return scope.startDate.setHours(0,0,0,0),scope.endDate.setHours(0,0,0,0),tDate>=scope.startDate&&tDate<=scope.endDate}var dateInitial=new Date,dateFinal=new Date,optionsWeek={weekday:"long"},optionsMonth={month:"long"},optionsYear={year:"numeric"},optionsDay={day:"numeric"},optionsAlmostComplete={day:"2-digit",month:"2-digit",year:"numeric"};scope.startDate=dateInitial.reverseFormat(dateInitial.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale),scope.endDate=dateFinal.reverseFormat(dateFinal.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale),scope.dateMap={},scope.$watch("startDate",function(newValue,oldValue){var tInitialDate=scope.startDate,tEndDate=scope.endDate;scope.dateInput=tInitialDate.toLocaleDateString(attrs.locale,optionsAlmostComplete)+" - "+tEndDate.toLocaleDateString(attrs.locale,optionsAlmostComplete)}),scope.$watch("endDate",function(newValue,oldValue){var tInitialDate=scope.startDate,tEndDate=scope.endDate;scope.dateInput=tInitialDate.toLocaleDateString(attrs.locale,optionsAlmostComplete)+" - "+tEndDate.toLocaleDateString(attrs.locale,optionsAlmostComplete)});var getLastSunday=function(d){var t=new Date(d);return t.setDate(t.getDate()-t.getDay()),t},getRangeDate=function(currentDate,endDate){var tempArray=[];for(endDate=new Date(endDate),currentDate.setHours(0,0,0,0),endDate.setHours(0,0,0,0);currentDate<=endDate;)tempArray.push(new Date(currentDate)),currentDate.setDate(currentDate.getDate()+1);return tempArray},changeDate=function(tDate,isInital){function setRangeDay(tDate){for(var start=new Date(tDate.getFullYear(),tDate.getMonth(),1),end=new Date(tDate.getFullYear(),tDate.getMonth()+1,0),weeks=[],dateInitialOverload=new Date,tDay=getLastSunday(dateInitialOverload),index=start.getDate();index<=end.getDate();index++){if(start.setDate(index),start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()==getLastSunday(new Date).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()||0===weeks.length){var week={};if(1===index)for(var cont=0;cont<7;cont++){var dt=tDay;week[getWeekDays(dt)[cont]]={},dt.setDate(dt.getDate()+cont)}weeks.push(week)}isInital?(scope.startDate.setHours(0,0,0,0),weeks[weeks.length-1][start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()]={date:new Date(start),"class":start.getTime()==scope.startDate.getTime()?"current-day-first":"",select:compareDate(start)?"hover-range-normal":"",isReadyOnly:new Date(start)>scope.endDate}):weeks[weeks.length-1][start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()]={date:new Date(start),"class":start.getTime()==scope.endDate.getTime()?"current-day-last":"",select:compareDate(start)?"hover-range-normal":"",isReadyOnly:new Date(start)<scope.startDate},isInital?1===index&&start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()!==getLastSunday(start).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()&&weeks.find(findFirstCalendarLast):1===index&&start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()!==getLastSunday(start).toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()&&weeks.find(findSecondCalendarLast),isInital?index==getLastDayOfMonth(tDate)&&start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()!==getNextSaturday()&&weeks.find(findFirstCalendarNext):index==getLastDayOfMonth(tDate)&&start.toLocaleDateString(attrs.locale,optionsWeek).capitalizeFirstLetter()!==getNextSaturday()&&weeks.find(findSecondCalendarNext)}return weeks}var month=tDate.toLocaleDateString(attrs.locale,optionsMonth).capitalizeFirstLetter(),year=tDate.toLocaleDateString(attrs.locale,optionsYear).capitalizeFirstLetter();isInital?(scope.dateInitialMap={month:month,year:year,result:setRangeDay(tDate,isInital),date:scope.startDate},scope.dateFinalMap||(scope.dateFinalMap={month:month,year:year,result:setRangeDay(tDate),date:scope.endDate})):scope.dateFinalMap={month:month,year:year,result:setRangeDay(tDate),date:scope.endDate}};changeDate(dateInitial,!0),changeDate(dateFinal,!1),scope.openModal=function(){scope.isOpen=!scope.isOpen},scope.chooseInitalDay=function(dt){dateInitial=dt.date,scope.startDate=dateInitial.reverseFormat(dateInitial.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale),changeDate(dt.date,!0),changeDate(scope.endDate,!1),setRangeDate()},scope.chooseFinalDay=function(dt){dateFinal=dt.date,scope.endDate=dateFinal.reverseFormat(dateFinal.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale),changeDate(dt.date,!1),changeDate(scope.startDate,!0),setRangeDate()};var tDateInitial=new Date;scope.allWeeks=getWeekDays(tDateInitial),scope.nextInitialMonth=function(isInital){var DECEMBER=11;isInital?(dateInitial=dateInitial.getMonth()==DECEMBER?new Date(dateInitial.getFullYear()+1,0,1):new Date(dateInitial.getFullYear(),dateInitial.getMonth()+1,1),scope.startDate=dateInitial.reverseFormat(dateInitial.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale)):(dateFinal=dateFinal.getMonth()==DECEMBER?new Date(dateFinal.getFullYear()+1,0,1):new Date(dateFinal.getFullYear(),dateFinal.getMonth()+1,1),scope.endDate=dateFinal.reverseFormat(dateFinal.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale)),setRangeDate()},scope.lastInitialMonth=function(isInital){var JANUARY=0;isInital?(dateInitial=dateInitial.getMonth()===JANUARY?new Date(dateInitial.getFullYear()-1,11,1):new Date(dateInitial.getFullYear(),dateInitial.getMonth()-1,1),scope.startDate=dateInitial.reverseFormat(dateInitial.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale)):(dateFinal=dateFinal.getMonth()===JANUARY?new Date(dateFinal.getFullYear()-1,11,1):new Date(dateFinal.getFullYear(),dateFinal.getMonth()-1,1),scope.endDate=dateFinal.reverseFormat(dateFinal.toLocaleDateString(attrs.locale,optionsAlmostComplete),attrs.locale)),setRangeDate()};var between=[],loadDate=new Date;loadDate.setHours(0,0,0,0),between.push(loadDate),ngModel.$setViewValue(between),angular.element(elem).on("change",function(event){between=[],setRangeDate()}),scope.selectYear=function(){var today=new Date;dateInitial=new Date,dateInitial.setMonth(today.getMonth()-12),scope.startDate=dateInitial,scope.endDate=new Date,between=[],setRangeDate()},scope.selectSemester=function(){var today=new Date;dateInitial=new Date,dateInitial.setMonth(today.getMonth()-6),scope.startDate=dateInitial,scope.endDate=new Date,between=[],setRangeDate()},scope.selectTrimester=function(){var today=new Date;dateInitial=new Date,dateInitial.setMonth(today.getMonth()-3),scope.startDate=dateInitial,scope.endDate=new Date,between=[],setRangeDate()},scope.selectMonth=function(){var today=new Date;dateInitial=new Date,dateInitial.setMonth(today.getMonth()-1),scope.startDate=dateInitial,scope.endDate=new Date,between=[],setRangeDate()},scope.selectWeek=function(){var today=new Date;dateInitial=new Date,dateInitial.setDate(today.getDate()-7),scope.startDate=dateInitial,scope.endDate=new Date,between=[],setRangeDate()},scope.selectLastDay=function(){var today=new Date;dateInitial=new Date,dateInitial.setDate(today.getDate()-1),scope.startDate=dateInitial,scope.endDate=dateInitial,between=[],setRangeDate()},scope.selectToday=function(){dateInitial=new Date,dateFinal=new Date,scope.startDate=new Date,scope.endDate=new Date,between=[],setRangeDate()}},template:"<div class='container'> <span class='span' ng-show='options.txtDateInit'>{{options.txtDateInit}}</span> <input type='text' ng-model='dateInput' ng-click='openModal()' ng-readonly='true' class='input-text' name='dateMap'> <div ng-show='!isOpen' class='line'> <div class='calendar column'> <header> <h2>{{ dateInitialMap.month }} - {{ dateInitialMap.year }}</h2> <a class='btn-prev fontawesome-angle-left' ng-click='lastInitialMonth(true)'>&#x2770</a> <a class='btn-next fontawesome-angle-right' ng-click='nextInitialMonth(true)'>&#x2771</a> </header> <table> <thead> <tr> <td ng-repeat='dayOfWeek in allWeeks'>{{dayOfWeek | limitTo: 3}}</td> </tr> </thead> <tbody> <tr ng-repeat='week in dateInitialMap.result'> <td ng-repeat='dayOfWeek in allWeeks' class='{{week[dayOfWeek].class}} {{week[dayOfWeek].select}}' ng-click='week[dayOfWeek].isReadyOnly ? $event.stopPropagation() : chooseInitalDay(week[dayOfWeek])'>{{week[dayOfWeek].date.getDate()}}</td> </tr> </tbody> </table> </div> <div class='calendar column padding-l'> <header> <h2>{{ dateFinalMap.month }} - {{ dateFinalMap.year }}</h2> <a class='btn-prev fontawesome-angle-left' ng-click='lastInitialMonth()'>&#x2770;</a> <a class='btn-next fontawesome-angle-right' ng-click='nextInitialMonth()'>&#x2771;</a> </header> <table> <thead> <tr> <td ng-repeat='dayOfWeek in allWeeks'>{{dayOfWeek | limitTo: 3}}</td> </tr> </thead> <tbody> <tr ng-repeat='week in dateFinalMap.result'> <td ng-repeat='dayOfWeek in allWeeks' class='{{week[dayOfWeek].class}} {{week[dayOfWeek].select}}' ng-click='week[dayOfWeek].isReadyOnly ? $event.stopPropagation() : chooseFinalDay(week[dayOfWeek])'>{{week[dayOfWeek].date.getDate()}}</td> </tr> </tbody> </table> </div> <div class='column padding-l'> <input type='button' ng-show='options.buttons.btnYear.txt' value='{{options.buttons.btnYear.txt}}' title='{{options.buttons.btnYear.tooltip}}' class='button btnFade btnYear' ng-click='selectYear();'> <br> <input type='button' ng-show='options.buttons.btnSemester.txt' value='{{options.buttons.btnSemester.txt}}' title='{{options.buttons.btnSemester.tooltip}}' class='button btnFade btnSemester' ng-click='selectSemester();'> <br> <input type='button' ng-show='options.buttons.btnTrimester.txt' value='{{options.buttons.btnTrimester.txt}}' title='{{options.buttons.btnTrimester.tooltip}}' class='button btnFade btnTrimester' ng-click='selectTrimester();'> <br> <input type='button' ng-show='options.buttons.btnMonth.txt' name='btnMes' value='{{ options.buttons.btnMonth.txt }}' title='{{options.buttons.btnMonth.tooltip}}' class='button btnFade btnMonth' ng-click='selectMonth();'> <br> <input type='button' ng-show='options.buttons.btnWeek.txt' value='{{options.buttons.btnWeek.txt}}' title='{{options.buttons.btnWeek.tooltip}}' class='button btnFade btnColorWeek' ng-click='selectWeek();'> <br> <input type='button' ng-show='options.buttons.btnLastDay.txt' value='{{options.buttons.btnLastDay.txt}}' title='{{options.buttons.btnLastDay.tooltip}}' class='button btnFade btnLastDay' ng-click='selectLastDay();'> <br> <input type='button' ng-show='options.buttons.btnToday.txt' value='{{options.buttons.btnToday.txt}}' title='{{options.buttons.btnToday.tooltip}}' class='button btnFade btnToday' ng-click='selectToday();'> </div> </div> </div>"}}])}(angular);